<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ورشة عباس أشلاف – حجز مواعيد الصيانة</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-database-compat.js"></script>

  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: 'Cairo', system-ui, sans-serif;
      background: linear-gradient(135deg, #f0f4f8, #d9e2ec);
      color: #1e293b;
      min-height: 100vh;
      padding: 20px 15px;
      line-height: 1.6;
    }
    .container { max-width: 1200px; margin: 0 auto; }
    h1 { text-align:center; margin: 1rem 0 2rem; color:#0f172a; font-size:2.2rem; }

    .lang-switcher {
      text-align: center;
      margin-bottom: 1.5rem;
    }
    .lang-btn {
      background: #1e40af;
      color: white;
      border: none;
      padding: 0.6rem 1.2rem;
      margin: 0 0.5rem;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
    }
    .lang-btn.active { background: #3b82f6; }

    .mechanic-card {
      background: white;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      padding: 2rem;
      margin-bottom: 2.5rem;
      text-align: center;
    }
    .mechanic-card img {
      width: 180px;
      height: 180px;
      border-radius: 50%;
      object-fit: cover;
      margin-bottom: 1rem;
      border: 4px solid #3b82f6;
    }
    .mechanic-card h2 { color: #1e40af; margin-bottom: 0.8rem; }
    .phone-number {
      font-size: 1.4rem;
      font-weight: bold;
      color: #1e40af;
      margin: 1rem 0;
      display: block;
    }
    .phone-number a {
      color: #1e40af;
      text-decoration: none;
    }
    .phone-number a:hover {
      text-decoration: underline;
    }

    .cards-wrapper {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
      gap: 2rem;
      margin-bottom: 3rem;
    }

    .card {
      background: white;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.08);
      overflow: hidden;
    }

    .card-header {
      background: #1e40af;
      color: white;
      padding: 1.3rem 1.8rem;
      font-size: 1.35rem;
      font-weight: 600;
    }

    .card-body { padding: 1.8rem; }

    .working-hours li {
      display: flex;
      justify-content: space-between;
      padding: 0.8rem 0;
      border-bottom: 1px dashed #e2e8f0;
    }
    .working-hours li:last-child { border-bottom: none; }
    .closed { color: #ef4444; font-weight: 600; }

    .booked-list { list-style: none; }
    .booked-item {
      padding: 1.1rem;
      margin-bottom: 1rem;
      background: #f8fafc;
      border-radius: 10px;
      border-right: 5px solid #3b82f6;
    }
    .booked-header { display: flex; justify-content: space-between; font-weight: 600; margin-bottom: 0.4rem; }
    .status {
      font-size: 0.9rem;
      padding: 0.3rem 0.8rem;
      border-radius: 999px;
      background: #dbeafe;
      color: #1d4ed8;
    }
    .empty { text-align:center; color:#64748b; font-style:italic; padding:2rem 0; }

    #booking-form { background:white; border-radius:16px; box-shadow:0 10px 40px rgba(0,0,0,0.08); padding:2.5rem; }
    .form-grid { display:grid; grid-template-columns:1fr 1fr; gap:1.4rem; }
    .full { grid-column:1/-1; }
    label { display:block; margin-bottom:0.5rem; font-weight:500; color:#334155; }
    input, select, textarea {
      width:100%; padding:0.9rem; border:1px solid #cbd5e1; border-radius:8px; font-size:1rem;
    }
    input:focus, select:focus, textarea:focus { outline:none; border-color:#3b82f6; box-shadow:0 0 0 3px rgba(59,130,246,0.15); }
    button {
      background:#2563eb; color:white; border:none; padding:1rem 2.5rem; font-size:1.1rem; font-weight:600;
      border-radius:10px; cursor:pointer; margin:2rem auto 0; display:block;
    }
    button:hover { background:#1d4ed8; }
    #message { margin-top:1.5rem; text-align:center; font-weight:500; padding:12px; border-radius:8px; }
    .success { background:#dcfce7; color:#166534; }
    .error   { background:#fee2e2; color:#991b1b; }

    #safety-advice {
      margin-top: 1.5rem;
      padding: 1.2rem;
      background: #fefce8;
      border: 1px solid #eab308;
      border-radius: 8px;
      color: #713f12;
      font-size: 1rem;
    }
    #safety-advice h4 { margin-bottom: 0.8rem; color: #854d0e; }

    @media (max-width: 700px) { .form-grid { grid-template-columns:1fr; } }
  </style>
</head>
<body data-lang="ar">

<div class="container">
  <div class="lang-switcher">
    <button class="lang-btn active" data-lang="ar">العربية</button>
    <button class="lang-btn" data-lang="fr">Français</button>
    <button class="lang-btn" data-lang="en">English</button>
  </div>

  <!-- بطاقة عباس أشلاف مع الرقم -->
  <div class="mechanic-card">
    <img src="https://via.placeholder.com/180?text=عباس+أشلاف" alt="عباس أشلاف">
    <h2 data-key="mechanic-name">عباس أشلاف</h2>
    <a href="tel:0550813883" class="phone-number">☎ 0550 81 38 83</a>
    <p data-key="mechanic-desc">ميكانيكي محترف بخبرة تزيد عن 15 سنة في صيانة وإصلاح جميع أنواع السيارات (بنزين – ديزل – هجينة). متخصص في أعطال المحرك، نظام التبريد، الفرامل، والكهرباء السيارات. يعمل بأحدث الأجهزة التشخيصية ويضمن جودة عالية ورضا العملاء.</p>
    <p data-key="mechanic-bio"><strong>سيرة ذاتية مختصرة:</strong> بدأ عباس أشلاف مسيرته في مجال الميكانيك منذ صغره في ورشة عائلية بالجزائر العاصمة، ثم تدرب في مراكز متخصصة في أوروبا والجزائر. حصل على شهادات في صيانة السيارات الحديثة وأنظمة الحقن الإلكتروني. يشتهر بالدقة، السرعة، والأمانة في العمل، ويهدف إلى تقديم خدمة احترافية بأسعار مناسبة لكل مواطن جزائري. للتواصل المباشر: <strong>0550 81 38 83</strong></p>
  </div>

  <h1 data-key="title">ورشة عباس أشلاف – حجز مواعيد الصيانة</h1>

  <div class="cards-wrapper">

    <div class="card">
      <div class="card-header" data-key="working-hours-title">مواقيت العمل</div>
      <div class="card-body">
        <ul class="working-hours">
          <li><span data-key="sunday">الأحد</span>     <span>09:00 – 16:00</span></li>
          <li><span data-key="monday">الإثنين</span>   <span>09:00 – 16:00</span></li>
          <li><span data-key="tuesday">الثلاثاء</span>  <span>09:00 – 16:00</span></li>
          <li><span data-key="wednesday">الأربعاء</span>  <span>09:00 – 16:00</span></li>
          <li><span data-key="thursday">الخميس</span>    <span>09:00 – 16:00</span></li>
          <li><span data-key="friday">الجمعة</span>    <span class="closed" data-key="closed">مغلق</span></li>
          <li><span data-key="saturday">السبت</span>     <span>09:30 – 16:00</span></li>
        </ul>
      </div>
    </div>

    <div class="card">
      <div class="card-header" data-key="booked-title">المواعيد المحجوزة</div>
      <div class="card-body">
        <ul class="booked-list" id="booked-list">
          <li class="empty" data-key="loading">جاري تحميل المواعيد...</li>
        </ul>
      </div>
    </div>

  </div>

  <div id="booking-form">
    <h2 data-key="book-now">احجز موعد جديد</h2>
    
    <form id="appointment-form">
      <div class="form-grid">
        <div>
          <label data-key="name-label">الاسم الكامل</label>
          <input type="text" id="name" required>
        </div>
        <div>
          <label data-key="phone-label">رقم الهاتف</label>
          <input type="tel" id="phone" required pattern="0[5-7][0-9]{8}">
        </div>
        <div>
          <label data-key="car-label">موديل السيارة</label>
          <input type="text" id="car" required placeholder="مثال: تويوتا كامري 2020">
        </div>
        <div>
          <label data-key="plate-label">رقم اللوحة (اختياري)</label>
          <input type="text" id="plate">
        </div>
        <div>
          <label data-key="date-label">تاريخ الموعد</label>
          <input type="date" id="date" required>
        </div>
        <div>
          <label data-key="time-label">الوقت</label>
          <select id="time" required>
            <option value="">اختر الوقت</option>
            <option value="09:00">09:00 – 10:30</option>
            <option value="10:30">10:30 – 12:00</option>
            <option value="12:00">12:00 – 13:30</option>
            <option value="13:30">13:30 – 15:00</option>
            <option value="15:00">15:00 – 16:00</option>
          </select>
        </div>
        <div class="full">
          <label data-key="issue-label">المشكلة الطارئة (مساعد طارئ)</label>
          <select id="emergency_issue" required>
            <option value="">-- اختر المشكلة --</option>
            <option value="oil_light">لمبة الزيت تضيء</option>
            <option value="overheating">تسخين زائد للمحرك</option>
            <option value="flat_tire">إطار مثقوب أو مفلطح</option>
            <option value="dead_battery">البطارية ميتة (السيارة لا تبدأ)</option>
            <option value="fluid_leak">تسرب سائل (زيت، ماء، إلخ)</option>
            <option value="brake_issue">مشكلة في الفرامل</option>
            <option value="engine_smoke">دخان من المحرك</option>
            <option value="other">أخرى</option>
          </select>
        </div>
        <div class="full" id="safety-advice" style="display: none;"></div>
        <div class="full">
          <label data-key="notes-label">ملاحظات إضافية</label>
          <textarea id="notes" rows="3" placeholder="وصف المشكلة إن وجدت..."></textarea>
        </div>
      </div>

      <button type="submit" data-key="submit-btn">تأكيد الحجز</button>
    </form>

    <div id="message"></div>
  </div>
</div>

<script>
  // Firebase Configuration
  const firebaseConfig = {
    apiKey: "AIzaSyCLCSPOV1nuk5RvQiSJcjc18rxXbC0Ei9Y",
    authDomain: "bot-djasser-achlaf-4494.firebaseapp.com",
    databaseURL: "https://bot-djasser-achlaf-4494-default-rtdb.firebaseio.com",
    projectId: "bot-djasser-achlaf-4494",
    storageBucket: "bot-djasser-achlaf-4494.firebasestorage.app",
    messagingSenderId: "500557963512",
    appId: "1:500557963512:web:a32bf5c21ba508662b5b0d"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const appointmentsRef = db.ref('appointments');

  const bookedList = document.getElementById('booked-list');
  const form = document.getElementById('appointment-form');
  const messageDiv = document.getElementById('message');
  const emergencySelect = document.getElementById('emergency_issue');
  const safetyAdviceDiv = document.getElementById('safety-advice');

  // الترجمات
  const translations = {
    ar: {
      title: "ورشة عباس أشلاف – حجز مواعيد الصيانة",
      mechanic_name: "عباس أشلاف",
      mechanic_desc: "ميكانيكي محترف بخبرة تزيد عن 15 سنة في صيانة وإصلاح جميع أنواع السيارات (بنزين – ديزل – هجينة). متخصص في أعطال المحرك، نظام التبريد، الفرامل، والكهرباء السيارات. يعمل بأحدث الأجهزة التشخيصية ويضمن جودة عالية ورضا العملاء.",
      mechanic_bio: "<strong>سيرة ذاتية مختصرة:</strong> بدأ عباس أشلاف مسيرته في مجال الميكانيك منذ صغره في ورشة عائلية بالجزائر العاصمة، ثم تدرب في مراكز متخصصة في أوروبا والجزائر. حصل على شهادات في صيانة السيارات الحديثة وأنظمة الحقن الإلكتروني. يشتهر بالدقة، السرعة، والأمانة في العمل، ويهدف إلى تقديم خدمة احترافية بأسعار مناسبة لكل مواطن جزائري. للتواصل المباشر: <strong>0550 81 38 83</strong>",
      working_hours_title: "مواقيت العمل",
      booked_title: "المواعيد المحجوزة",
      book_now: "احجز موعد جديد",
      loading: "جاري تحميل المواعيد...",
      sunday: "الأحد", monday: "الإثنين", tuesday: "الثلاثاء",
      wednesday: "الأربعاء", thursday: "الخميس", friday: "الجمعة",
      saturday: "السبت", closed: "مغلق",
      name_label: "الاسم الكامل",
      phone_label: "رقم الهاتف",
      car_label: "موديل السيارة",
      plate_label: "رقم اللوحة (اختياري)",
      date_label: "تاريخ الموعد",
      time_label: "الوقت",
      issue_label: "المشكلة الطارئة (مساعد طارئ)",
      notes_label: "ملاحظات إضافية",
      submit_btn: "تأكيد الحجز"
    },
    fr: {
      title: "Atelier Abbas Achlaf – Réservation de rendez-vous",
      mechanic_name: "Abbas Achlaf",
      mechanic_desc: "Mécanicien professionnel avec plus de 15 ans d'expérience...",
      mechanic_bio: "<strong>Biographie courte :</strong> Abbas Achlaf a commencé... Pour contact direct : <strong>0550 81 38 83</strong>",
      working_hours_title: "Horaires de travail",
      booked_title: "Rendez-vous réservés",
      book_now: "Réserver un nouveau rendez-vous",
      loading: "Chargement des rendez-vous en cours...",
      sunday: "Dimanche", monday: "Lundi", tuesday: "Mardi",
      wednesday: "Mercredi", thursday: "Jeudi", friday: "Vendredi",
      saturday: "Samedi", closed: "Fermé",
      name_label: "Nom complet",
      phone_label: "Numéro de téléphone",
      car_label: "Modèle du véhicule",
      plate_label: "Numéro d'immatriculation (optionnel)",
      date_label: "Date du rendez-vous",
      time_label: "Heure",
      issue_label: "Problème urgent (assistant d'urgence)",
      notes_label: "Remarques supplémentaires",
      submit_btn: "Confirmer la réservation"
    },
    en: {
      title: "Abbas Achlaf Garage – Appointment Booking",
      mechanic_name: "Abbas Achlaf",
      mechanic_desc: "Professional mechanic with over 15 years of experience...",
      mechanic_bio: "<strong>Short Biography:</strong> Abbas Achlaf began... Direct contact: <strong>0550 81 38 83</strong>",
      working_hours_title: "Working Hours",
      booked_title: "Booked Appointments",
      book_now: "Book a New Appointment",
      loading: "Loading appointments...",
      sunday: "Sunday", monday: "Monday", tuesday: "Tuesday",
      wednesday: "Wednesday", thursday: "Thursday", friday: "Friday",
      saturday: "Saturday", closed: "Closed",
      name_label: "Full Name",
      phone_label: "Phone Number",
      car_label: "Car Model",
      plate_label: "License Plate (optional)",
      date_label: "Appointment Date",
      time_label: "Time",
      issue_label: "Emergency Issue (Emergency Assistant)",
      notes_label: "Additional Notes",
      submit_btn: "Confirm Booking"
    }
  };

  // تغيير اللغة
  document.querySelectorAll('.lang-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const lang = btn.dataset.lang;
      document.body.dataset.lang = lang;
      document.body.dir = (lang === 'ar') ? 'rtl' : 'ltr';

      document.querySelectorAll('[data-key]').forEach(el => {
        const key = el.dataset.key;
        if (translations[lang][key]) el.innerHTML = translations[lang][key];
      });

      document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
    });
  });

  // عرض الحجوزات في الوقت الفعلي
  appointmentsRef.on('value', (snapshot) => {
    bookedList.innerHTML = '';

    if (!snapshot.exists() || Object.keys(snapshot.val() || {}).length === 0) {
      bookedList.innerHTML = `<li class="empty">${translations[document.body.dataset.lang].loading}</li>`;
      return;
    }

    const data = snapshot.val();
    Object.entries(data).forEach(([key, appt]) => {
      const li = document.createElement('li');
      li.className = 'booked-item';
      li.innerHTML = `
        <div class="booked-header">
          <span>${appt.date || 'غير محدد'}</span>
          <span class="status">محجوز</span>
        </div>
        <div>${appt.time || 'غير محدد'}</div>
        <div style="color:#475569; margin-top:0.4rem;">
          ${appt.name} – ${appt.car || ''} – ${appt.issue || ''}
        </div>
      `;
      bookedList.appendChild(li);
    });
  });

  // ضبط الحد الأدنى للتاريخ
  document.getElementById('date').min = new Date().toISOString().split('T')[0];

  // نصائح الأمان (مختصرة)
const safetyProtocols = {
  oil_light: {
    ar: "<h4>نصيحة أمان فورية:</h4><p>توقف فوراً، أطفئ المحرك، واترك السيارة تبرد 30 دقيقة على الأقل. لا تقد لتجنب تلف المحرك.</p>",
    fr: "<h4>Conseil immédiat :</h4><p>Arrêtez immédiatement, coupez le moteur et laissez refroidir 30 minutes. Ne conduisez pas.</p>",
    en: "<h4>Immediate advice:</h4><p>Stop immediately, turn off the engine, and let it cool for at least 30 minutes. Do not drive.</p>"
  },

  engine_overheat: {
    ar: "<h4>تحذير حرارة المحرك:</h4><p>توقف فوراً وافتح غطاء المحرك بحذر بعد التبريد. لا تكمل القيادة.</p>",
    fr: "<h4>Surchauffe moteur :</h4><p>Arrêtez-vous immédiatement et ouvrez le capot avec précaution après refroidissement.</p>",
    en: "<h4>Engine overheating:</h4><p>Stop immediately and carefully open the hood after cooling.</p>"
  },

  brake_failure: {
    ar: "<h4>فشل نظام الفرامل:</h4><p>خفف السرعة تدريجياً، استخدم فرامل اليد، وتوقف في مكان آمن.</p>",
    fr: "<h4>Panne de freins :</h4><p>Ralentissez progressivement et utilisez le frein à main.</p>",
    en: "<h4>Brake failure:</h4><p>Slow down gradually and use the handbrake.</p>"
  },

  abs_warning: {
    ar: "<h4>تحذير ABS:</h4><p>قد تقل كفاءة الفرامل. قد بحذر وتوجه لأقرب مركز صيانة.</p>",
    fr: "<h4>Avertissement ABS :</h4><p>L'efficacité du freinage peut être réduite.</p>",
    en: "<h4>ABS warning:</h4><p>Braking efficiency may be reduced. Drive carefully.</p>"
  },

  airbag_warning: {
    ar: "<h4>تحذير الوسائد الهوائية:</h4><p>نظام الأمان قد لا يعمل. افحص السيارة فوراً.</p>",
    fr: "<h4>Avertissement airbag :</h4><p>Le système de sécurité peut être inactif.</p>",
    en: "<h4>Airbag warning:</h4><p>Safety system may not function properly.</p>"
  },

  low_tire_pressure: {
    ar: "<h4>انخفاض ضغط الإطارات:</h4><p>خفف السرعة وافحص الإطارات في أقرب وقت.</p>",
    fr: "<h4>Pression des pneus basse :</h4><p>Ralentissez et vérifiez les pneus.</p>",
    en: "<h4>Low tire pressure:</h4><p>Slow down and check tires soon.</p>"
  },

  battery_warning: {
    ar: "<h4>تحذير البطارية:</h4><p>أوقف الأنظمة غير الضرورية وتوجه للصيانة.</p>",
    fr: "<h4>Avertissement batterie :</h4><p>Éteignez les systèmes inutiles.</p>",
    en: "<h4>Battery warning:</h4><p>Turn off non-essential systems.</p>"
  },

  power_steering_failure: {
    ar: "<h4>عطل التوجيه:</h4><p>قد تصبح عجلة القيادة ثقيلة. توقف بأمان.</p>",
    fr: "<h4>Défaillance direction :</h4><p>Le volant peut devenir dur.</p>",
    en: "<h4>Power steering failure:</h4><p>Steering wheel may feel heavy.</p>"
  },

  transmission_issue: {
    ar: "<h4>عطل ناقل الحركة:</h4><p>توقف ولا تضغط على دواسة الوقود.</p>",
    fr: "<h4>Problème transmission :</h4><p>Arrêtez le véhicule immédiatement.</p>",
    en: "<h4>Transmission issue:</h4><p>Stop the vehicle and avoid acceleration.</p>"
  },

  fuel_leak: {
    ar: "<h4>تسرب وقود:</h4><p>أوقف السيارة فوراً وابتعد عنها.</p>",
    fr: "<h4>Fuite de carburant :</h4><p>Arrêtez-vous et éloignez-vous.</p>",
    en: "<h4>Fuel leak:</h4><p>Stop immediately and move away.</p>"
  },

  door_open: {
    ar: "<h4>باب مفتوح:</h4><p>توقف وأغلق جميع الأبواب بإحكام.</p>",
    fr: "<h4>Porte ouverte :</h4><p>Arrêtez-vous et fermez les portes.</p>",
    en: "<h4>Door open:</h4><p>Stop and close all doors securely.</p>"
  },

  hood_open: {
    ar: "<h4>غطاء المحرك مفتوح:</h4><p>توقف فوراً قبل أن يعيق الرؤية.</p>",
    fr: "<h4>Capot ouvert :</h4><p>Arrêtez immédiatement.</p>",
    en: "<h4>Hood open:</h4><p>Stop immediately to avoid obstruction.</p>"
  },

  trunk_open: {
    ar: "<h4>الصندوق الخلفي مفتوح:</h4><p>توقف وأغلقه بإحكام.</p>",
    fr: "<h4>Coffre ouvert :</h4><p>Arrêtez et fermez-le.</p>",
    en: "<h4>Trunk open:</h4><p>Stop and close it securely.</p>"
  },

  headlights_failure: {
    ar: "<h4>عطل المصابيح:</h4><p>تجنب القيادة ليلاً.</p>",
    fr: "<h4>Panne des phares :</h4><p>Évitez de conduire la nuit.</p>",
    en: "<h4>Headlight failure:</h4><p>Avoid night driving.</p>"
  },

  fog_lights_on: {
    ar: "<h4>مصابيح الضباب:</h4><p>استخدمها فقط عند ضعف الرؤية.</p>",
    fr: "<h4>Feux antibrouillard :</h4><p>Utilisez-les uniquement si nécessaire.</p>",
    en: "<h4>Fog lights:</h4><p>Use only in low visibility.</p>"
  },

  seatbelt_unfastened: {
    ar: "<h4>حزام الأمان:</h4><p>يرجى ربط حزام الأمان فوراً.</p>",
    fr: "<h4>Ceinture non attachée :</h4><p>Veuillez attacher votre ceinture.</p>",
    en: "<h4>Seatbelt unfastened:</h4><p>Please fasten your seatbelt.</p>"
  },

  driver_drowsy: {
    ar: "<h4>إرهاق السائق:</h4><p>توقف وخذ قسطاً من الراحة.</p>",
    fr: "<h4>Fatigue conducteur :</h4><p>Arrêtez-vous et reposez-vous.</p>",
    en: "<h4>Driver drowsy:</h4><p>Stop and take a break.</p>"
  },

  collision_warning: {
    ar: "<h4>تحذير تصادم:</h4><p>خفف السرعة فوراً.</p>",
    fr: "<h4>Alerte collision :</h4><p>Ralentissez immédiatement.</p>",
    en: "<h4>Collision warning:</h4><p>Reduce speed immediately.</p>"
  },

  lane_departure: {
    ar: "<h4>مغادرة المسار:</h4><p>صحح مسارك بحذر.</p>",
    fr: "<h4>Sortie de voie :</h4><p>Corrigez votre trajectoire.</p>",
    en: "<h4>Lane departure:</h4><p>Correct your lane position.</p>"
  },

  blind_spot_alert: {
    ar: "<h4>نقطة عمياء:</h4><p>تحقق قبل تغيير المسار.</p>",
    fr: "<h4>Angle mort :</h4><p>Vérifiez avant de changer de voie.</p>",
    en: "<h4>Blind spot alert:</h4><p>Check before changing lanes.</p>"
  },

  adaptive_cruise_error: {
    ar: "<h4>خلل مثبت السرعة:</h4><p>قد يلغى النظام تلقائياً.</p>",
    fr: "<h4>Régulateur adaptatif :</h4><p>Système désactivé.</p>",
    en: "<h4>Adaptive cruise error:</h4><p>System may be disabled.</p>"
  },

  traction_control_off: {
    ar: "<h4>تعطيل مانع الانزلاق:</h4><p>قد بحذر خاصة على الطرق الزلقة.</p>",
    fr: "<h4>Antipatinage désactivé :</h4><p>Conduisez prudemment.</p>",
    en: "<h4>Traction control off:</h4><p>Drive carefully on slippery roads.</p>"
  },

  esp_warning: {
    ar: "<h4>تحذير ESP:</h4><p>قد تقل الثباتية أثناء المناورات.</p>",
    fr: "<h4>Avertissement ESP :</h4><p>Stabilité réduite.</p>",
    en: "<h4>ESP warning:</h4><p>Vehicle stability may be reduced.</p>"
  },

  exhaust_issue: {
    ar: "<h4>مشكلة العادم:</h4><p>تجنب استنشاق الغازات.</p>",
    fr: "<h4>Problème d'échappement :</h4><p>Évitez l'inhalation.</p>",
    en: "<h4>Exhaust issue:</h4><p>Avoid inhaling fumes.</p>"
  },

  coolant_low: {
    ar: "<h4>نقص سائل التبريد:</h4><p>أوقف السيارة بعد التبريد وأضف السائل.</p>",
    fr: "<h4>Liquide de refroidissement bas :</h4><p>Complétez après refroidissement.</p>",
    en: "<h4>Coolant low:</h4><p>Refill after engine cools.</p>"
  },

  washer_fluid_low: {
    ar: "<h4>نقص سائل المساحات:</h4><p>أضف السائل لتحسين الرؤية.</p>",
    fr: "<h4>Liquide lave-glace bas :</h4><p>Ajoutez du liquide.</p>",
    en: "<h4>Washer fluid low:</h4><p>Refill washer fluid.</p>"
  },

  immobilizer_error: {
    ar: "<h4>خلل نظام الحماية:</h4><p>قد لا يعمل المحرك.</p>",
    fr: "<h4>Erreur antidémarrage :</h4><p>Le moteur peut ne pas démarrer.</p>",
    en: "<h4>Immobilizer error:</h4><p>Engine may not start.</p>"
  },

  key_not_detected: {
    ar: "<h4>المفتاح غير مكتشف:</h4><p>تأكد من وجود المفتاح داخل السيارة.</p>",
    fr: "<h4>Clé non détectée :</h4><p>Vérifiez la clé.</p>",
    en: "<h4>Key not detected:</h4><p>Ensure key is inside vehicle.</p>"
  },

  parking_brake_on: {
    ar: "<h4>فرامل اليد مفعلة:</h4><p>حررها قبل القيادة.</p>",
    fr: "<h4>Frein à main activé :</h4><p>Désactivez-le.</p>",
    en: "<h4>Parking brake on:</h4><p>Release before driving.</p>"
  },

  suspension_fault: {
    ar: "<h4>عطل نظام التعليق:</h4><p>قد تقل الراحة والثبات.</p>",
    fr: "<h4>Défaut suspension :</h4><p>Confort réduit.</p>",
    en: "<h4>Suspension fault:</h4><p>Ride comfort may be affected.</p>"
  },

  rain_sensor_error: {
    ar: "<h4>خلل حساس المطر:</h4><p>شغل المساحات يدوياً.</p>",
    fr: "<h4>Capteur de pluie :</h4><p>Utilisez manuellement.</p>",
    en: "<h4>Rain sensor error:</h4><p>Operate wipers manually.</p>"
  },

  speed_limit_warning: {
    ar: "<h4>تجاوز السرعة:</h4><p>خفف السرعة لتجنب المخالفات.</p>",
    fr: "<h4>Dépassement de vitesse :</h4><p>Ralentissez.</p>",
    en: "<h4>Speed limit warning:</h4><p>Reduce speed.</p>"
  },

  gps_signal_lost: {
    ar: "<h4>فقدان إشارة GPS:</h4><p>استخدم اللوحات الإرشادية.</p>",
    fr: "<h4>Signal GPS perdu :</h4><p>Suivez la signalisation.</p>",
    en: "<h4>GPS signal lost:</h4><p>Follow road signs.</p>"
  },

  camera_blocked: {
    ar: "<h4>الكاميرا محجوبة:</h4><p>نظف العدسة.</p>",
    fr: "<h4>Caméra bloquée :</h4><p>Nettoyez la lentille.</p>",
    en: "<h4>Camera blocked:</h4><p>Clean the lens.</p>"
  },

  radar_blocked: {
    ar: "<h4>الرادار محجوب:</h4><p>قد تتعطل أنظمة المساعدة.</p>",
    fr: "<h4>Radar bloqué :</h4><p>Systèmes désactivés.</p>",
    en: "<h4>Radar blocked:</h4><p>Driver assistance may be disabled.</p>"
  },

  auto_start_stop_error: {
    ar: "<h4>خلل الإيقاف التلقائي:</h4><p>النظام غير متاح.</p>",
    fr: "<h4>Start-Stop défaillant :</h4><p>Système indisponible.</p>",
    en: "<h4>Auto start-stop error:</h4><p>System unavailable.</p>"
  },

  child_lock_on: {
    ar: "<h4>قفل الأطفال:</h4><p>الأبواب الخلفية مغلقة.</p>",
    fr: "<h4>Sécurité enfant :</h4><p>Portes arrière verrouillées.</p>",
    en: "<h4>Child lock on:</h4><p>Rear doors locked.</p>"
  },

  other: {
    ar: "<h4>نصيحة عامة:</h4><p>توقف في مكان آمن واتبع تعليمات السلامة.</p>",
    fr: "<h4>Conseil général :</h4><p>Arrêtez-vous dans un endroit sûr.</p>",
    en: "<h4>General advice:</h4><p>Stop in a safe place and follow safety instructions.</p>"
  }
};


  emergencySelect.addEventListener('change', (e) => {
    const issue = e.target.value;
    const lang = document.body.dataset.lang;
    if (issue && safetyProtocols[issue] && safetyProtocols[issue][lang]) {
      safetyAdviceDiv.innerHTML = safetyProtocols[issue][lang];
      safetyAdviceDiv.style.display = 'block';
    } else {
      safetyAdviceDiv.style.display = 'none';
    }
  });

  // حفظ مع التحقق من عدم التعارض
  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const lang = document.body.dataset.lang;

    const newAppt = {
      name:   document.getElementById('name').value.trim(),
      phone:  document.getElementById('phone').value.trim(),
      car:    document.getElementById('car').value.trim(),
      plate:  document.getElementById('plate').value.trim() || null,
      date:   document.getElementById('date').value,
      time:   document.getElementById('time').value,
      issue:  document.getElementById('emergency_issue').value,
      notes:  document.getElementById('notes').value.trim() || null,
      createdAt: firebase.database.ServerValue.TIMESTAMP
    };

    // التحقق من الحقول المطلوبة
    if (!newAppt.name || !newAppt.phone || !newAppt.date || !newAppt.time || !newAppt.issue) {
      messageDiv.textContent = lang === 'ar' ? 'يرجى ملء جميع الحقول المطلوبة' :
                               lang === 'fr' ? 'Veuillez remplir tous les champs obligatoires' :
                               'Please fill in all required fields';
      messageDiv.className = 'error';
      return;
    }

    try {
      // التحقق من التعارض
      const snapshot = await appointmentsRef
        .orderByChild('date')
        .equalTo(newAppt.date)
        .once('value');

      let conflict = false;

      if (snapshot.exists()) {
        snapshot.forEach(child => {
          const existing = child.val();
          if (existing.time === newAppt.time) {
            conflict = true;
          }
        });
      }

      if (conflict) {
        messageDiv.textContent = lang === 'ar' ? 'هذا الموعد محجوز مسبقاً! اختر وقتاً آخر.' :
                                 lang === 'fr' ? 'Ce créneau est déjà réservé ! Choisissez un autre horaire.' :
                                 'This time slot is already booked! Please choose another time.';
        messageDiv.className = 'error';
        return;
      }

      // لا يوجد تعارض → حفظ
      await appointmentsRef.push(newAppt);

      messageDiv.textContent = lang === 'ar' ? 'تم حفظ الحجز بنجاح! سيتم التواصل معك قريباً.' :
                               lang === 'fr' ? 'Rendez-vous enregistré avec succès !' :
                               'Booking saved successfully!';
      messageDiv.className = 'success';
      form.reset();
      safetyAdviceDiv.style.display = 'none';

    } catch (error) {
      messageDiv.textContent = (lang === 'ar' ? 'حدث خطأ: ' : 
                               lang === 'fr' ? 'Erreur : ' : 
                               'Error: ') + error.message;
      messageDiv.className = 'error';
      console.error(error);
    }
  });
</script>

</body>
</html>

